


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > GeneralReportHandler</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.spenditure.logic</a>
</div>

<h1>Coverage Summary for Class: GeneralReportHandler (com.spenditure.logic)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">GeneralReportHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/106)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * GeneralReportHandler
&nbsp; *
&nbsp; * COMP3350 SECTION A02
&nbsp; *
&nbsp; * @author JR,
&nbsp; * @date Mar 2
&nbsp; *
&nbsp; * PURPOSE:
&nbsp; *  Handles all reporting related to statistics that are not dependant on a time frame.
&nbsp; *  Namely: summnation statistics for categories, summnation statistics for all transactions, and sorting categories by these statistics
&nbsp; *
&nbsp; **/
&nbsp;
&nbsp;
&nbsp;package com.spenditure.logic;
&nbsp;
&nbsp;import com.spenditure.application.Services;
&nbsp;import com.spenditure.database.CategoryPersistence;
&nbsp;import com.spenditure.database.TransactionPersistence;
&nbsp;import com.spenditure.database.stub.TransactionStub;
&nbsp;import com.spenditure.logic.exceptions.InvalidTransactionException;
&nbsp;import com.spenditure.object.CategoryReport;
&nbsp;import com.spenditure.object.CategoryStatistics;
&nbsp;import com.spenditure.object.ICategoryReport;
&nbsp;import com.spenditure.object.IDateTime;
&nbsp;import com.spenditure.object.IMainCategory;
&nbsp;import com.spenditure.object.MainCategory;
&nbsp;import com.spenditure.object.Transaction;
&nbsp;import com.spenditure.logic.exceptions.*;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.List;
&nbsp;
&nbsp;public class GeneralReportHandler implements IGeneralReportHandler{
&nbsp;    private TransactionPersistence dataAccessTransaction;
&nbsp;    private CategoryPersistence dataAccessCategory;
&nbsp;
&nbsp;    /**
&nbsp;     * constructor
&nbsp;     *
&nbsp;     * initializes needed databases
&nbsp;     * @param boolean getStubDB - if true then we use stub not sql
&nbsp;     * @returns NA
&nbsp;     */
<b class="nc">&nbsp;    public GeneralReportHandler(boolean getStubDB) {</b>
<b class="nc">&nbsp;        this.dataAccessTransaction = Services.getTransactionPersistence(getStubDB);</b>
<b class="nc">&nbsp;        this.dataAccessCategory = Services.getCategoryPersistence(getStubDB);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * numTransactions
&nbsp;     *
&nbsp;     * Returns the number of transactions in a particular category
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param int categoryID - categoryID of category to be accessed
&nbsp;     * @returns int - number of transactions
&nbsp;     */
&nbsp;    public int numTransactions(int userID, int categoryID) throws InvalidLogInException, InvalidCategoryException
&nbsp;    {
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
<b class="nc">&nbsp;        if(categoryID &lt; 0)</b>
<b class="nc">&nbsp;            throw new InvalidCategoryException(&quot;That category does not exist&quot;);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        return dataAccessTransaction.getTransactionsByCategoryID(categoryID).size();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * totalSpending
&nbsp;     *
&nbsp;     * Returns the total spending in a particular category
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param int categoryID - categoryID of category to be accessed
&nbsp;     * @returns double - total spending
&nbsp;     */
&nbsp;    public double totalSpending(int userID, int categoryID) throws InvalidLogInException, InvalidCategoryException
&nbsp;    {
&nbsp;        List&lt;Transaction&gt; allTransactions;
&nbsp;
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
<b class="nc">&nbsp;        if(categoryID &lt; 0)</b>
<b class="nc">&nbsp;            throw new InvalidCategoryException(&quot;That category does not exist&quot; + categoryID);</b>
&nbsp;
<b class="nc">&nbsp;        double total = 0;</b>
&nbsp;
&nbsp;
&nbsp;
<b class="nc">&nbsp;        allTransactions = dataAccessTransaction.getTransactionsByCategoryID(categoryID);</b>
&nbsp;
&nbsp;        // calculate total
<b class="nc">&nbsp;        for(int i = 0; i &lt; allTransactions.size(); i++)</b>
&nbsp;        {
<b class="nc">&nbsp;            total += allTransactions.get(i).getAmount();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return total;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * averageSpending
&nbsp;     *
&nbsp;     * Returns the average spending in a particular category
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param int categoryID - categoryID of category to be accessed
&nbsp;     * @returns double - average spending
&nbsp;     */
&nbsp;    public double averageSpending(int userID, int categoryID) throws InvalidLogInException, InvalidCategoryException
&nbsp;    {
&nbsp;
&nbsp;        double average;
&nbsp;
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
<b class="nc">&nbsp;        if(categoryID &lt; 0)</b>
<b class="nc">&nbsp;            throw new InvalidCategoryException(&quot;That category does not exist&quot;);</b>
&nbsp;
&nbsp;        // to avoid dividing by 0 check if there are no transactions
<b class="nc">&nbsp;        if(numTransactions(userID, categoryID) == 0)</b>
&nbsp;        {
<b class="nc">&nbsp;            average = 0;</b>
&nbsp;        }
&nbsp;        else
&nbsp;        {
<b class="nc">&nbsp;            average = totalSpending(userID, categoryID) / numTransactions(userID, categoryID);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return average;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * percentage
&nbsp;     *
&nbsp;     * Returns the percentage of all spending made up by that category
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param int categoryID - categoryID of category to be accessed
&nbsp;     * @returns double - percentage
&nbsp;     */
&nbsp;    public double percentage(int userID, int categoryID) throws InvalidLogInException, InvalidCategoryException
&nbsp;    {
&nbsp;
&nbsp;        double percentage;
&nbsp;
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
<b class="nc">&nbsp;        if(categoryID &lt; 0)</b>
<b class="nc">&nbsp;            throw new InvalidCategoryException(&quot;That category does not exist&quot;);</b>
&nbsp;
&nbsp;        // to avoid dividing by 0 check if there are no transactions
<b class="nc">&nbsp;        if(numTransactions(userID, categoryID) == 0)</b>
&nbsp;        {
<b class="nc">&nbsp;            percentage = 0;</b>
&nbsp;        }
&nbsp;        else
&nbsp;        {
<b class="nc">&nbsp;            percentage = (totalSpending(userID, categoryID)/totalSpending(userID)) * 100;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return percentage;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * numTransactions
&nbsp;     *
&nbsp;     * Returns the number of transactions in fpr a user
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @returns int - number of transactions
&nbsp;     */
&nbsp;    public int numTransactions(int userID) throws InvalidLogInException
&nbsp;    {
<b class="nc">&nbsp;        if(userID &lt; 0 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        return dataAccessTransaction.getAllTransactionsForUser(userID).size();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * totalSpending
&nbsp;     *
&nbsp;     * Returns the total spending in for person logged in
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @returns double - total spending
&nbsp;     */
&nbsp;    public double totalSpending(int userID) throws InvalidLogInException
&nbsp;    {
&nbsp;        List&lt;Transaction&gt; allTransactions;
<b class="nc">&nbsp;        double total = 0;</b>
&nbsp;
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        allTransactions = dataAccessTransaction.getAllTransactionsForUser(userID);</b>
&nbsp;
&nbsp;
&nbsp;        // calculate total
<b class="nc">&nbsp;        for(int i = 0; i &lt; allTransactions.size(); i++)</b>
&nbsp;        {
<b class="nc">&nbsp;            total += allTransactions.get(i).getAmount();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return total;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * averageSpending
&nbsp;     *
&nbsp;     * Returns the average spending in for a user
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @returns double - average spending
&nbsp;     */
&nbsp;    public double averageSpending(int userID) throws InvalidLogInException
&nbsp;    {
&nbsp;
&nbsp;        double average;
&nbsp;
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
&nbsp;        // to avoid dividing by 0 check if there are no transactions
<b class="nc">&nbsp;        if(numTransactions(userID) == 0)</b>
&nbsp;        {
<b class="nc">&nbsp;            average = 0;</b>
&nbsp;        }
&nbsp;        else
&nbsp;        {
<b class="nc">&nbsp;            average = totalSpending(userID) / numTransactions(userID);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return average;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * getCategoryReport
&nbsp;     *
&nbsp;     * Returns a category report object with statistics about the selected category
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param int categoryID - categoryID of category to be reported on
&nbsp;     * @returns ICategoryReport - report object
&nbsp;     */
&nbsp;    public ICategoryReport getCategoryReport(int userID, int categoryID) throws InvalidLogInException, InvalidCategoryException
&nbsp;    {
&nbsp;        double totalSpending;
&nbsp;        int numTransactions;
&nbsp;        double average;
&nbsp;        double percentage;
&nbsp;
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
<b class="nc">&nbsp;        if(categoryID &lt; 0)</b>
<b class="nc">&nbsp;            throw new InvalidCategoryException(&quot;That category does not exist&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        totalSpending = totalSpending(userID, categoryID);</b>
<b class="nc">&nbsp;        numTransactions = numTransactions(userID, categoryID);</b>
<b class="nc">&nbsp;        average = averageSpending(userID, categoryID);</b>
<b class="nc">&nbsp;        percentage = percentage(userID, categoryID);</b>
&nbsp;
<b class="nc">&nbsp;        return new CategoryReport(dataAccessCategory.getCategoryByID(categoryID), totalSpending, numTransactions, average, percentage);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * sortByTotal
&nbsp;     *
&nbsp;     * Returns a list of all categories for a user sorted by total number of transactions in each
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param boolean descending - if true then sorted in descending order, else ascending
&nbsp;     * @returns ArrayList&lt;IMainCategory&gt; - sorted array list
&nbsp;     */
&nbsp;    public ArrayList&lt;IMainCategory&gt; sortByTotal(int userID, boolean descending) throws InvalidLogInException
&nbsp;    {
<b class="nc">&nbsp;        ArrayList&lt;ICategoryReport&gt; categoryReportList = new ArrayList&lt;ICategoryReport&gt;();</b>
&nbsp;        List&lt;MainCategory&gt; mainCategoryList;
<b class="nc">&nbsp;        ArrayList&lt;IMainCategory&gt; sortedCategories = new ArrayList&lt;IMainCategory&gt;();</b>
&nbsp;
&nbsp;        // ensure someone is logged in
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
&nbsp;        // get all categories for a user
<b class="nc">&nbsp;        mainCategoryList = dataAccessCategory.getAllCategory(userID);</b>
&nbsp;
&nbsp;        // generate report for each category user has
<b class="nc">&nbsp;        for(MainCategory node : mainCategoryList)</b>
&nbsp;        {
<b class="nc">&nbsp;            categoryReportList.add(getCategoryReport(userID, node.getCategoryID()));</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // sort categories by total
<b class="nc">&nbsp;        Collections.sort(categoryReportList, (node1, node2) -&gt; {</b>
&nbsp;            // Compare based on the &#39;total&#39; attribute
<b class="nc">&nbsp;            if(descending) {</b>
<b class="nc">&nbsp;                return Double.compare(node2.getTotalSpending(), node1.getTotalSpending());</b>
&nbsp;            }
&nbsp;            else {
<b class="nc">&nbsp;                return Double.compare(node1.getTotalSpending(), node2.getTotalSpending());</b>
&nbsp;            }
&nbsp;
&nbsp;        });
&nbsp;
&nbsp;        // take out category objects from sorted list of category reports
<b class="nc">&nbsp;        for (ICategoryReport node : categoryReportList) {</b>
<b class="nc">&nbsp;            sortedCategories.add(node.getCategory());</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return sortedCategories;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * sortByPercent
&nbsp;     *
&nbsp;     * Returns a list of all categories for a user sorted by percentage of total amount spend
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param boolean descending - if true then sorted in descending order, else ascending
&nbsp;     * @returns ArrayList&lt;IMainCategory&gt; - sorted array list
&nbsp;     */
&nbsp;    public ArrayList&lt;IMainCategory&gt; sortByPercent(int userID, boolean descending) throws InvalidLogInException
&nbsp;    {
<b class="nc">&nbsp;        ArrayList&lt;ICategoryReport&gt; categoryReportList = new ArrayList&lt;ICategoryReport&gt;();</b>
&nbsp;        List&lt;MainCategory&gt; mainCategoryList;
<b class="nc">&nbsp;        ArrayList&lt;IMainCategory&gt; sortedCategories = new ArrayList&lt;IMainCategory&gt;();</b>
&nbsp;
&nbsp;        // ensure someone is logged in
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
&nbsp;        // get all categories for a user
<b class="nc">&nbsp;        mainCategoryList = dataAccessCategory.getAllCategory(userID);</b>
&nbsp;
&nbsp;        // generate report for each category user has
<b class="nc">&nbsp;        for(MainCategory node : mainCategoryList)</b>
&nbsp;        {
<b class="nc">&nbsp;            categoryReportList.add(getCategoryReport(userID, node.getCategoryID()));</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // sort categories by percentage
<b class="nc">&nbsp;        Collections.sort(categoryReportList, (node1, node2) -&gt; {</b>
&nbsp;            // Compare based on the &#39;percentage&#39; attribute
<b class="nc">&nbsp;            if(descending) {</b>
<b class="nc">&nbsp;                return Double.compare(node2.getPercentage(), node1.getPercentage());</b>
&nbsp;            }
&nbsp;            else {
<b class="nc">&nbsp;                return Double.compare(node1.getPercentage(), node2.getPercentage());</b>
&nbsp;            }
&nbsp;            // =D, you found the secret smiley face, have a nice day!
&nbsp;        });
&nbsp;
&nbsp;        // take out category objects from sorted list of category reports
<b class="nc">&nbsp;        for (ICategoryReport node : categoryReportList) {</b>
<b class="nc">&nbsp;            sortedCategories.add(node.getCategory());</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return sortedCategories;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * sortByAverage
&nbsp;     *
&nbsp;     * Returns a list of all categories for a user sorted by average amount spent in that category
&nbsp;     * @param int userID - userID of person logged in
&nbsp;     * @param boolean descending - if true then sorted in descending order, else ascending
&nbsp;     * @returns ArrayList&lt;IMainCategory&gt; - sorted array list
&nbsp;     */
&nbsp;    public ArrayList&lt;IMainCategory&gt; sortByAverage(int userID, boolean descending) throws InvalidLogInException
&nbsp;    {
<b class="nc">&nbsp;        ArrayList&lt;ICategoryReport&gt; categoryReportList = new ArrayList&lt;ICategoryReport&gt;();</b>
&nbsp;        List&lt;MainCategory&gt; mainCategoryList;
<b class="nc">&nbsp;        ArrayList&lt;IMainCategory&gt; sortedCategories = new ArrayList&lt;IMainCategory&gt;();</b>
&nbsp;
&nbsp;        // ensure someone is logged in
<b class="nc">&nbsp;        if(userID == -1 )</b>
<b class="nc">&nbsp;            throw new InvalidLogInException();</b>
&nbsp;
&nbsp;        // get all categories for a user
<b class="nc">&nbsp;        mainCategoryList = dataAccessCategory.getAllCategory(userID);</b>
&nbsp;
&nbsp;
&nbsp;        // generate report for each category user has
<b class="nc">&nbsp;        for(MainCategory node : mainCategoryList)</b>
&nbsp;        {
<b class="nc">&nbsp;            categoryReportList.add(getCategoryReport(userID, node.getCategoryID()));</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // sort categories by average
<b class="nc">&nbsp;        Collections.sort(categoryReportList, (node1, node2) -&gt; {</b>
&nbsp;            // Compare based on the &#39;average&#39; attribute
<b class="nc">&nbsp;            if(descending) {</b>
<b class="nc">&nbsp;                return Double.compare(node2.getAverageTransactions(), node1.getAverageTransactions());</b>
&nbsp;            }
&nbsp;            else {
<b class="nc">&nbsp;                return Double.compare(node1.getTotalSpending(), node2.getTotalSpending());</b>
&nbsp;            }
&nbsp;
&nbsp;        });
&nbsp;
&nbsp;        // take out category objects from sorted list of category reports
<b class="nc">&nbsp;        for (ICategoryReport node : categoryReportList) {</b>
<b class="nc">&nbsp;            sortedCategories.add(node.getCategory());</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return sortedCategories;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-03-05 12:38</div>
</div>
</body>
</html>
